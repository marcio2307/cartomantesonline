<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Painel Administrativo ‚Äî Cartomantes Online</title>
<style>
body { font-family: Arial, sans-serif; background:#000; color:#fff; padding:20px; }
h1, h2 { text-align:center; color:#ffd700; text-shadow:0 0 10px #ff0; }
label { font-weight:bold; color:yellow; margin-top:10px; display:block; }
input, select, textarea, button {
  width:100%; padding:10px; margin-bottom:15px;
  border-radius:6px; border:none; font-size:16px;
}
button { background:red; color:#fff; cursor:pointer; transition:0.3s; }
button:hover { background:#b30000; }
#loginForm { max-width:320px; margin:auto; margin-top:30px; }
#painelGeral { display:none; margin-top:20px; }
.tabs { text-align:center; margin-bottom:25px; }
.tabs button {
  background:#111; color:#ffd700; border:1px solid #ff0000;
  margin:0 10px; padding:10px 20px; border-radius:6px;
}
.tabs button.active { background:red; color:#fff; }
.section { display:none; }
table { width:100%; border-collapse:collapse; margin-top:10px; font-size:14px; }
th, td { border:1px solid #333; padding:8px; text-align:left; }
th { background:#111; color:#ffd700; }
tr:nth-child(even){ background:#111; }
button.excluir { background:#ff0000; padding:5px 10px; border:none; border-radius:4px; font-size:13px; }
button.excluir:hover { background:#b30000; }
footer { text-align:center; margin-top:30px; color:#888; }
</style>
</head>
<body>

<h1>Painel Administrativo ‚Äî Cartomantes Online</h1>

<!-- LOGIN -->
<div id="loginForm">
  <label>Usu√°rio:</label>
  <input type="text" id="username">
  <label>Senha:</label>
  <input type="password" id="password">
  <button onclick="login()">Entrar</button>
</div>

<!-- PAINEL GERAL -->
<div id="painelGeral">
  <div class="tabs">
    <button id="btnAgendamento" class="active" onclick="mostrar('agendamento')">üìÖ Agendamentos</button>
    <button id="btnColetivo" onclick="mostrar('coletivo')">üî• Coletivo</button>
    <button onclick="logout()">Sair</button>
  </div>

  <!-- AGENDAMENTOS -->
  <div id="agendamento" class="section" style="display:block;">
    <h2>üóìÔ∏è Painel de Agendamentos</h2>
    <table id="tabelaAgendamento">
      <thead>
        <tr>
          <th>Data/Hora</th>
          <th>Nome</th>
          <th>WhatsApp</th>
          <th>Dia Marcado</th>
          <th>Hor√°rio</th>
          <th>Pacote</th>
          <th>A√ß√µes</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <p id="erroAgendamento" style="color:red; text-align:center;"></p>
  </div>

  <!-- COLETIVO -->
  <div id="coletivo" class="section">
    <h2>üî• Painel do Coletivo</h2>
    <form id="formColetivo">
      <label for="titulo">T√≠tulo:</label>
      <input id="titulo" name="titulo" required>

      <label for="data">Data:</label>
      <input id="data" name="data" required>

      <label for="valor">Valor:</label>
      <input id="valor" name="valor" required>

      <label for="desc">Descri√ß√£o:</label>
      <textarea id="desc" name="desc" rows="4" required></textarea>

      <label for="img">URL da imagem:</label>
      <input id="img" name="img" required>

      <label for="vagas">N√∫mero de vagas:</label>
      <input id="vagas" name="vagas" type="number" min="1" required>

      <button type="submit">üíæ Salvar Coletivo</button>
    </form>

    <div id="confirmacao" style="display:none; color:#0cdfb9; text-align:center;">‚úÖ Coletivo atualizado com sucesso!</div>
  </div>
</div>

<footer>¬© 2025 ‚Äî Cartomantes Online</footer>

<script>
// ================== LOGIN ==================
const ADMIN_USER = "admin";
const ADMIN_PASS = "1234";

// üîó TROQUE AQUI PELO SEU LINK DO APPS SCRIPT (AGENDAMENTOS)
const scriptAgendamento = "https://script.google.com/macros/s/AKfycbwl4s5pIqfKLd8H33jHkpM3XL56UnQGB-p7amWrah6x2AAs3KyTxEl-CFeOu_vuXnPNNw/exec";
// üîó LINK DO COLETIVO
const scriptColetivo = "https://script.google.com/macros/s/AKfycbw47QavcdkCgLKFk223ZcwcuZIpPiZo-9otrGUhpR6rpaST-YjGoXhIDQ3ZVjy7trRSgw/exec";

function login(){
  const user = username.value;
  const pass = password.value;
  if(user===ADMIN_USER && pass===ADMIN_PASS){
    loginForm.style.display='none';
    painelGeral.style.display='block';
    carregarAgendamentos();
    carregarColetivo();
  } else alert("Usu√°rio ou senha incorretos!");
}

function logout(){
  painelGeral.style.display='none';
  loginForm.style.display='block';
  username.value='';
  password.value='';
}

function mostrar(secao){
  document.querySelectorAll('.section').forEach(s=>s.style.display='none');
  document.getElementById(secao).style.display='block';
  document.querySelectorAll('.tabs button').forEach(b=>b.classList.remove('active'));
  if(secao==='agendamento') btnAgendamento.classList.add('active');
  if(secao==='coletivo') btnColetivo.classList.add('active');
}

// ================== AGENDAMENTOS ==================
function carregarAgendamentos(){
  fetch(scriptAgendamento)
    .then(res => res.json())
    .then(data => {
      const tbody = document.querySelector("#tabelaAgendamento tbody");
      tbody.innerHTML = "";
      if (!data || data.length === 0){
        erroAgendamento.textContent = "Nenhum agendamento encontrado.";
        return;
      }

      data.forEach((item, i) => {
        // üîÆ Corrigir hora num√©rica (planilha tipo 0.875 vira 21:00)
        let horaFormatada = "Sem hor√°rio definido";
        if (item.hora) {
          let valor = item.hora.toString().trim();
          let num = parseFloat(valor);
          if (!isNaN(num) && num > 0 && num < 2) {
            let totalMin = Math.round(num * 24 * 60);
            let h = Math.floor(totalMin / 60);
            let m = totalMin % 60;
            horaFormatada = `Consulta agendada para ${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}`;
          } else if (valor.includes(":")) {
            horaFormatada = `Consulta agendada para ${valor}`;
          }
        }

        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${new Date(item.timestamp).toLocaleString("pt-BR")}</td>
          <td>${item.nome}</td>
          <td>${item.whatsapp}</td>
          <td>${item.data}</td>
          <td>${horaFormatada}</td>
          <td>${item.pacote}</td>
          <td><button class='excluir' onclick='excluirAgendamento(${i+2})'>Excluir</button></td>`;
        tbody.appendChild(tr);
      });
    })
    .catch(err => erroAgendamento.textContent = "Erro ao carregar agendamentos: " + err.message);
}

// üî¥ Fun√ß√£o de exclus√£o corrigida
function excluirAgendamento(linha){
  if(!confirm("Tem certeza que deseja excluir este agendamento?")) return;
  fetch(`${scriptAgendamento}?action=delete&linha=${linha}`, { method: "GET" })
    .then(res => res.text())
    .then(() => {
      alert("Agendamento exclu√≠do com sucesso!");
      carregarAgendamentos();
    })
    .catch(err => alert("Erro ao excluir: " + err.message));
}

// ================== COLETIVO ==================
const form = document.getElementById('formColetivo');
const confirmacao = document.getElementById('confirmacao');

form.addEventListener('submit', e => {
  e.preventDefault();
  const formData = new FormData(form);
  fetch(scriptColetivo, { method:'POST', body:formData })
    .then(res => res.text())
    .then(()=>{ confirmacao.style.display='block'; setTimeout(()=>confirmacao.style.display='none',4000); })
    .catch(err=>alert("Erro ao salvar coletivo: " + err.message));
});

function carregarColetivo(){
  fetch(scriptColetivo)
    .then(res=>res.json())
    .then(data=>{
      if(!data || data.error) return;
      titulo.value = data.titulo || "";
      data.value = data.data || "";
      valor.value = data.valor || "";
      desc.value = data.desc || "";
      img.value = data.img || "";
      vagas.value = data.vagas || "";
    })
    .catch(()=>{});
}
</script>
</body>
</html>
