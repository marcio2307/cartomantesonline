<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pagar Consulta - Cartomantes Online</title>
<style>
body {
  background: radial-gradient(circle at top, #1a1a1a, #000);
  color: #fff; font-family: 'Poppins', Arial, sans-serif;
  margin: 0; padding: 20px;
}
.container {
  max-width: 420px; margin: 40px auto;
  background: rgba(255,255,255,0.05);
  border: 2px solid gold; border-radius: 15px;
  padding: 25px; box-shadow: 0 0 20px rgba(255,215,0,0.2);
  text-align: center;
}
.consultor-img { width: 150px; border-radius: 10px; margin-bottom: 10px; }
h1 { color: gold; font-size: 22px; margin: 10px 0; }
p { font-size: 14px; color: #ccc; margin-bottom: 20px; }
.option {
  background: rgba(255,255,255,0.08); border: 1px solid #c7a008;
  border-radius: 10px; padding: 15px; margin-bottom: 10px;
  cursor: pointer; transition: all 0.3s ease;
}
.option:hover { background: rgba(255,215,0,0.15); transform: scale(1.02); }
.option.selected { background: rgba(255,215,0,0.3); border: 2px solid gold; }
.pix-logo { width: 120px; margin: 20px auto; display: block; filter: drop-shadow(0 0 6px #0cdfb9); }
.pix-btn {
  background: linear-gradient(90deg, #00bfa5, #00937b);
  border: none; color: white; padding: 12px 20px;
  border-radius: 8px; font-size: 16px; cursor: pointer;
  font-weight: bold; transition: transform 0.2s ease;
  width: 100%; max-width: 250px;
}
.pix-btn:hover { transform: scale(1.05); }
.price-display { color: gold; font-size: 20px; margin-top: 20px; font-weight: bold; }
#qrcode { margin-top: 20px; }
small { color: #aaa; font-size: 13px; white-space: pre-wrap; display: block; margin-top: 10px; }
#copyButton {
  background: gold; color: black; border: none;
  padding: 10px 18px; border-radius: 8px;
  font-size: 15px; font-weight: bold;
  cursor: pointer; margin-top: 10px;
}
#copyButton:hover { background: #ffd700; transform: scale(1.05); }
</style>
</head>
<body>
<div class="container">
  <img id="consultorImagem" class="consultor-img" src="" alt="Consultor">
  <h1 id="consultorNome">Consultor</h1>
  <p>Escolha quantos minutos deseja na sua consulta.</p>
  <div id="opcoes"></div>
  <div class="price-display" id="precoSelecionado">Selecione uma opÃ§Ã£o</div>
  <img class="pix-logo" src="https://upload.wikimedia.org/wikipedia/commons/0/04/Logo_Pix.svg" alt="PIX Logo">
  <button class="pix-btn" id="pixButton" disabled>Gerar QR Code Pix</button>
  <div id="qrcode"></div>
  <small id="pixCopiaCola"></small>
  <button id="copyButton" style="display:none;">ðŸ“‹ Copiar cÃ³digo Pix</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script>
const nome = "Consultor";
const valorPorMinuto = 1.00;
const imagem = "https://via.placeholder.com/150";
document.getElementById('consultorNome').textContent = nome;
document.getElementById('consultorImagem').src = imagem;

const chavePix = "09161666351";
const nomeDestinatario = "Cartomantes Online";
const cidade = "Fortaleza";

// ---- FUNÃ‡ÃƒO CRC16 ----
function crc16(payload) {
  let crc = 0xFFFF;
  for (let i = 0; i < payload.length; i++) {
    crc ^= payload.charCodeAt(i) << 8;
    for (let j = 0; j < 8; j++) {
      crc = (crc & 0x8000) ? ((crc << 1) ^ 0x1021) : (crc << 1);
      crc &= 0xFFFF;
    }
  }
  return crc.toString(16).toUpperCase().padStart(4, "0");
}

// ---- GERADOR DO PIX EMV COMPLETO ----
function gerarPayloadPix(chave, nome, cidade, valor, txid) {
  function t(id, v) {
    return id + v.length.toString().padStart(2, "0") + v;
  }
  const gui = "br.gov.bcb.pix";
  const merchantAccount = t("00", gui) + t("01", chave);
  const merchantInfo = t("26", merchantAccount);
  const tx = txid || "CONSULTA";
  const base =
    "000201" +
    merchantInfo +
    "52040000" +
    "5303986" +
    t("54", parseFloat(valor).toFixed(2)) +
    "5802BR" +
    t("59", nome) +
    t("60", cidade) +
    t("62", "05" + t("05", tx)) +
    "6304";
  return base + crc16(base);
}

// ---- INTERFACE ----
const minutos = [10, 20, 30, 60];
const opcoesDiv = document.getElementById('opcoes');
const precoSelecionado = document.getElementById('precoSelecionado');
const botaoPix = document.getElementById('pixButton');
const botaoCopiar = document.getElementById('copyButton');
let valorSelecionado = null;

minutos.forEach(m => {
  const preco = (m * valorPorMinuto).toFixed(2);
  const div = document.createElement('div');
  div.className = 'option';
  div.innerHTML = `<h2>${m} Minutos</h2><p>R$ ${preco}</p>`;
  div.onclick = () => {
    document.querySelectorAll('.option').forEach(o => o.classList.remove('selected'));
    div.classList.add('selected');
    valorSelecionado = preco;
    precoSelecionado.textContent = `VocÃª selecionou ${m} minutos - R$ ${preco}`;
    botaoPix.disabled = false;
  };
  opcoesDiv.appendChild(div);
});

// ---- GERAR PIX ----
botaoPix.onclick = () => {
  if (valorSelecionado) {
    const valorPix = Number(valorSelecionado).toFixed(2);
    const txid = "CONSULTA" + Date.now();
    const payload = gerarPayloadPix(chavePix, nomeDestinatario, cidade, valorPix, txid);

    document.getElementById("qrcode").innerHTML = "";
    document.getElementById("pixCopiaCola").innerText = "";
    botaoCopiar.style.display = "none";

    new QRCode(document.getElementById("qrcode"), {
      text: payload,
      width: 200,
      height: 200,
      colorDark: "#00ffcc",
      colorLight: "#000000",
      correctLevel: QRCode.CorrectLevel.H
    });

    document.getElementById("pixCopiaCola").innerText =
      "CÃ³digo Pix copia e cola:\n\n" + payload +
      "\n\nâœ… Escaneie o QR acima ou copie o cÃ³digo para pagar.";

    botaoCopiar.style.display = "inline-block";
    botaoCopiar.onclick = () => {
      navigator.clipboard.writeText(payload).then(() => {
        botaoCopiar.innerText = "âœ… CÃ³digo copiado!";
        setTimeout(() => { botaoCopiar.innerText = "ðŸ“‹ Copiar cÃ³digo Pix"; }, 2500);
      });
    };
  }
};
</script>
</body>
</html>
