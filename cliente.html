-<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cliente - MSN Retr√¥</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
*{box-sizing:border-box;margin:0;padding:0;}
body{
  background:linear-gradient(180deg,#dfe8ff,#b7c9ff);
  font-family:'Tahoma',sans-serif;
  display:flex;justify-content:center;align-items:center;height:100vh;
}
.chat{
  width:100%;max-width:460px;height:90vh;
  background:#f3f6ff;border:3px solid #7aa0ff;border-radius:10px;
  box-shadow:0 0 25px rgba(0,0,0,0.3);
  display:flex;flex-direction:column;overflow:hidden;
}
header{
  background:linear-gradient(180deg,#a9c4ff,#4e7bff);
  color:white;padding:8px 12px;font-weight:bold;
  display:flex;align-items:center;justify-content:space-between;
  border-bottom:2px solid #3a65c9;
}
header img{width:22px;height:22px;margin-right:6px;}
header span{display:flex;align-items:center;gap:6px;font-size:15px;}
#nudgeBtn{
  background:linear-gradient(180deg,#ffec90,#ffd000);
  border:none;border-radius:6px;padding:5px 10px;cursor:pointer;
  font-weight:bold;box-shadow:0 2px 3px rgba(0,0,0,0.2);
}
.avatars{
  text-align:center;background:#e8eeff;padding:10px;border-bottom:1px solid #aac2ff;
}
.avatars img{width:80px;height:80px;border-radius:10px;border:2px solid #4e7bff;}
.messages{
  flex:1;overflow-y:auto;padding:10px;background:#eef3ff;display:flex;flex-direction:column;gap:10px;
}
.message{
  max-width:75%;padding:8px 14px;border-radius:15px;position:relative;font-size:14px;line-height:1.4;
  box-shadow:0 1px 3px rgba(0,0,0,0.15);word-wrap:break-word;
}
.cliente{background:#b4d2ff;color:#001f66;align-self:flex-end;}
.atendente{background:white;color:#1b2e66;align-self:flex-start;border:1px solid #c6d7ff;}
.delete-btn{
  position:absolute;top:-5px;right:-5px;background:#ff4d4d;color:#fff;border:none;
  border-radius:50%;width:18px;height:18px;font-size:11px;cursor:pointer;display:none;
}
.message:hover .delete-btn{display:block;}
.tools{
  background:#dfe8ff;padding:5px 10px;display:flex;gap:6px;border-top:1px solid #aac2ff;
}
.tools button{background:none;border:none;cursor:pointer;font-size:18px;}
.input-area{
  display:flex;padding:8px;background:#dce6ff;border-top:1px solid #aac2ff;
}
input{
  flex:1;padding:10px;border-radius:20px;border:1px solid #7ba8ff;
  background:white;font-size:14px;outline:none;
}
button.send{
  margin-left:8px;border:none;background:linear-gradient(180deg,#6da6ff,#3e7bff);
  color:white;font-weight:bold;border-radius:20px;padding:10px 16px;cursor:pointer;
}
.typing{font-size:12px;color:#444;margin:4px 12px;}
</style>
</head>
<body>

<div class="chat" id="chatBox">
  <header>
    <span><img src="https://cdn-icons-png.flaticon.com/512/236/236832.png">Cliente</span>
    <button id="nudgeBtn">üí• Nudge</button>
  </header>

  <div class="avatars">
    <input type="file" id="fotoInput" accept="image/*" style="display:none;">
    <img id="fotoCliente" src="https://cdn-icons-png.flaticon.com/512/236/236832.png" onclick="document.getElementById('fotoInput').click()">
    <div><small>Clique na foto para trocar</small></div>
    <hr style="margin:10px 0;border:none;border-top:1px solid #aabfff;">
    <img id="fotoAtendente" src="https://cdn-icons-png.flaticon.com/512/194/194938.png">
  </div>

  <div id="messages" class="messages"></div>
  <div id="typing" class="typing"></div>

  <div class="tools">
    <button onclick="insertEmoji('üòÄ')">üòÄ</button>
    <button onclick="insertEmoji('üòÇ')">üòÇ</button>
    <button onclick="insertEmoji('üòç')">üòç</button>
    <button onclick="insertEmoji('üíî')">üíî</button>
  </div>

  <div class="input-area">
    <input id="msgInput" type="text" placeholder="Digite sua mensagem...">
    <button class="send" onclick="sendMessage()">Enviar</button>
  </div>
</div>

<audio id="sendSound" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg"></audio>
<audio id="receiveSound" src="https://actions.google.com/sounds/v1/cartoon/pop.ogg"></audio>
<audio id="nudgeSound" src="https://www.myinstants.com/media/sounds/msn-nudge.mp3"></audio>

<script>
const firebaseConfig={
  apiKey:"AIzaSyA7XSLTDxayTOczs7-sW5s0_nx7nkDgVo",
  authDomain:"coletivo2025-9de23.firebaseapp.com",
  databaseURL:"https://coletivo2025-9de23-default-rtdb.firebaseio.com",
  projectId:"coletivo2025-9de23",
  storageBucket:"coletivo2025-9de23.appspot.com",
  messagingSenderId:"740866367489",
  appId:"1:740866367489:web:963e3f5be80cb35a71e000"
};
firebase.initializeApp(firebaseConfig);
const db=firebase.database();

const msgDiv=document.getElementById("messages");
const input=document.getElementById("msgInput");
const typingDiv=document.getElementById("typing");
const sendSound=document.getElementById("sendSound");
const receiveSound=document.getElementById("receiveSound");
const nudgeSound=document.getElementById("nudgeSound");
const chatBox=document.getElementById("chatBox");

function insertEmoji(e){input.value+=e;input.focus();}

// --- FOTO LOCAL ---
const fotoInput=document.getElementById("fotoInput");
const fotoCliente=document.getElementById("fotoCliente");
fotoInput.addEventListener("change",()=>{
  const file=fotoInput.files[0];
  if(file){
    const reader=new FileReader();
    reader.onload=e=>{
      fotoCliente.src=e.target.result;
      db.ref("fotos/cliente").set(e.target.result);
    };
    reader.readAsDataURL(file);
  }
});
db.ref("fotos/atendente").on("value",snap=>{
  if(snap.val())document.getElementById("fotoAtendente").src=snap.val();
});

// --- RECEBER MENSAGENS ---
db.ref("chat").on("child_added",snap=>{
  const msg=snap.val(),id=snap.key;
  if(!msg||!msg.text)return;
  const div=document.createElement("div");
  div.classList.add("message",msg.user);
  div.innerHTML=msg.text;
  if(msg.user==="cliente"){
    const del=document.createElement("button");
    del.textContent="√ó";
    del.className="delete-btn";
    del.onclick=()=>db.ref("chat/"+id).remove();
    div.appendChild(del);
  }
  msgDiv.appendChild(div);
  msgDiv.scrollTop=msgDiv.scrollHeight;
  if(msg.user!=="cliente")receiveSound.play();else sendSound.play();
});
db.ref("chat").on("child_removed",snap=>{
  const removed=snap.val();
  document.querySelectorAll(".message").forEach(el=>{
    if(el.textContent.includes(removed.text))el.remove();
  });
});

// --- DIGITANDO ---
db.ref("typing").on("value",snap=>{
  const val=snap.val();
  typingDiv.textContent=(val&&val.user!=="cliente")?"‚úçÔ∏è atendente est√° digitando...":"";
});
input.addEventListener("input",()=>{
  db.ref("typing").set({user:"cliente"});
  setTimeout(()=>db.ref("typing").set(null),1000);
});

// --- ENVIAR ---
function sendMessage(){
  const text=input.value.trim();
  if(!text)return;
  db.ref("chat").push({user:"cliente",text});
  input.value="";
  db.ref("typing").set(null);
}
input.addEventListener("keypress",e=>{
  if(e.key==="Enter"){e.preventDefault();sendMessage();}
});

// --- NUDGE ---
document.getElementById("nudgeBtn").onclick=()=>{
  nudgeSound.play();
  chatBox.classList.add("shake");
  setTimeout(()=>chatBox.classList.remove("shake"),500);
};
</script>

<style>
@keyframes shake {
  0%{transform:translate(0);}
  25%{transform:translate(5px,-5px);}
  50%{transform:translate(-5px,5px);}
  75%{transform:translate(5px,5px);}
  100%{transform:translate(0);}
}
.shake{animation:shake 0.3s;}
</style>
</body>
</html>
