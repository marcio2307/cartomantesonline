<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MSN - Cliente</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
*{box-sizing:border-box;margin:0;padding:0;}
body{
  font-family:'Tahoma',sans-serif;
  background:#b3d4ff;
  display:flex;justify-content:center;align-items:center;
  height:100vh;
}
.chat{
  width:100%;max-width:480px;height:90vh;
  background:#f5f7ff;border:3px solid #7aa0ff;
  border-radius:8px;box-shadow:0 0 25px rgba(0,0,0,0.3);
  display:flex;flex-direction:column;overflow:hidden;
}
header{
  background:linear-gradient(180deg,#9dc1ff,#598aff);
  color:white;padding:6px 10px;font-weight:bold;
  display:flex;align-items:center;justify-content:space-between;
  border-bottom:2px solid #4979d1;
}
header img{width:22px;height:22px;vertical-align:middle;margin-right:5px;}
header span{font-size:15px;}
.avatars{
  background:#e5edff;display:flex;justify-content:space-between;
  align-items:center;padding:8px 12px;border-bottom:1px solid #aac2ff;
}
.avatars img{width:60px;height:60px;border-radius:10px;border:2px solid #598aff;}
.messages{
  flex:1;padding:15px;background:#eef3ff;overflow-y:auto;
  display:flex;flex-direction:column;gap:10px;scroll-behavior:smooth;
}
.message{
  max-width:75%;padding:10px 14px;border-radius:16px;
  position:relative;font-size:14px;line-height:1.4;
  box-shadow:0 1px 3px rgba(0,0,0,0.15);word-wrap:break-word;
}
.cliente{
  background:#b4d2ff;color:#002f77;align-self:flex-end;
  border-bottom-right-radius:2px;
}
.atendente{
  background:#fff;border:1px solid #b5c9ff;color:#1b2e66;
  align-self:flex-start;border-bottom-left-radius:2px;
}
.delete-btn{display:none;}
.tools{
  background:#dfe8ff;padding:6px 10px;display:flex;align-items:center;gap:8px;
  border-top:1px solid #aac2ff;
}
.tools button{background:none;border:none;cursor:pointer;font-size:18px;}
.input-area{
  display:flex;padding:8px;background:#dce6ff;border-top:1px solid #aac2ff;
}
input{
  flex:1;padding:10px;border-radius:20px;border:1px solid #7ba8ff;
  background:#fff;font-size:14px;outline:none;
}
button.send{
  margin-left:8px;border:none;background:linear-gradient(180deg,#6da6ff,#3e7bff);
  color:white;font-weight:bold;border-radius:20px;padding:10px 16px;cursor:pointer;
}
.typing{font-size:12px;color:#444;margin-left:10px;}
</style>
</head>
<body>

<div class="chat">
  <header>
    <span><img src="https://cdn-icons-png.flaticon.com/512/732/732222.png"> MSN - Cliente</span>
  </header>

  <div class="avatars">
    <img src="https://cdn-icons-png.flaticon.com/512/236/236832.png">
    <span>üí¨ Cliente conversando com Atendente</span>
    <img src="https://cdn-icons-png.flaticon.com/512/194/194938.png">
  </div>

  <div id="messages" class="messages"></div>
  <div id="typing" class="typing"></div>

  <div class="tools">
    <button onclick="insertEmoji('üòÄ')">üòÄ</button>
    <button onclick="insertEmoji('üòÇ')">üòÇ</button>
    <button onclick="insertEmoji('üòç')">üòç</button>
    <button onclick="insertEmoji('üíî')">üíî</button>
  </div>

  <div class="input-area">
    <input id="msgInput" type="text" placeholder="Digite sua mensagem...">
    <button class="send" onclick="sendMessage()">Enviar</button>
  </div>
</div>

<audio id="sendSound" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>
<audio id="receiveSound" src="https://actions.google.com/sounds/v1/cartoon/pop.ogg"></audio>

<script>
const firebaseConfig={
  apiKey:"AIzaSyA7XSLTDxayTOczs7-sW5s0_nx7nkDgVo",
  authDomain:"coletivo2025-9de23.firebaseapp.com",
  databaseURL:"https://coletivo2025-9de23-default-rtdb.firebaseio.com",
  projectId:"coletivo2025-9de23",
  storageBucket:"coletivo2025-9de23.appspot.com",
  messagingSenderId:"740866367489",
  appId:"1:740866367489:web:963e3f5be80cb35a71e000"
};
firebase.initializeApp(firebaseConfig);
const db=firebase.database();
const messagesDiv=document.getElementById("messages");
const input=document.getElementById("msgInput");
const typingDiv=document.getElementById("typing");
const sendSound=document.getElementById("sendSound");
const receiveSound=document.getElementById("receiveSound");

function insertEmoji(e){input.value+=e;input.focus();}

// Receber
db.ref("chat").on("child_added",snap=>{
  const msg=snap.val(),id=snap.key;
  if(!msg||!msg.text)return;
  const div=document.createElement("div");
  div.classList.add("message",msg.user);
  div.innerHTML=msg.text;
  messagesDiv.appendChild(div);
  messagesDiv.scrollTop=messagesDiv.scrollHeight;
  if(msg.user!=="cliente")receiveSound.play();
  else sendSound.play();
});

// Mostrar digitando
db.ref("typing").on("value",snap=>{
  const val=snap.val();
  if(val&&val.user!=="cliente")
    typingDiv.textContent="‚úçÔ∏è atendente est√° digitando...";
  else typingDiv.textContent="";
});

// Enviar
function sendMessage(){
  const text=input.value.trim();
  if(!text)return;
  db.ref("chat").push({user:"cliente",text});
  input.value="";db.ref("typing").set(null);
}

// Digita√ß√£o
input.addEventListener("input",()=>{
  db.ref("typing").set({user:"cliente"});
  setTimeout(()=>db.ref("typing").set(null),1000);
});
input.addEventListener("keypress",e=>{
  if(e.key==="Enter"){e.preventDefault();sendMessage();}
});
</script>
</body>
</html>
