<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Painel do Cliente â€” Cartomantes Online</title>
  <style>
    :root{
      --roxo:#621770; --turq:#0cdfb9; --bg:#0f0a12; --card:#1a1220;
      --txt:#f7f5f9; --muted:#c9bfd4; --ok:#22c55e; --warn:#f59e0b;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial;
      background:radial-gradient(1200px 600px at 80% -10%, rgba(98,23,112,0.22), transparent),
                 linear-gradient(180deg, #110915, #0b0710 60%, #09060c);
      color:var(--txt);
    }
    .wrap{max-width:960px; margin:0 auto; padding:24px}
    header{display:flex; align-items:center; justify-content:space-between; gap:16px; margin-bottom:12px;}
    .brand{display:flex; align-items:center; gap:12px}
    .logo{width:44px; height:44px; border-radius:12px;
      background:linear-gradient(135deg,var(--roxo),#a64ccf);
      display:grid; place-items:center; color:#fff; font-weight:700;
      box-shadow:0 10px 30px rgba(98,23,112,.35);
    }
    .title h1{font-size:20px; margin:0}
    .title small{color:var(--muted)}
    .card{
      background:var(--card); border:1px solid rgba(255,255,255,.06);
      border-radius:16px; padding:18px; box-shadow:0 10px 24px rgba(0,0,0,.28);
    }
    .grid{display:grid; gap:16px}
    @media (min-width:780px){ .grid{grid-template-columns:1.2fr .8fr} }
    .saldo{display:flex; align-items:flex-end; gap:12px; flex-wrap:wrap;}
    .saldo h2{margin:0; font-size:15px; color:var(--muted)}
    .valor{
      font-size:40px; font-weight:800; letter-spacing:-.5px;
      background:linear-gradient(180deg,#fff,#d8cbe2);
      -webkit-background-clip:text; color:transparent;
    }
    .badge{
      font-size:12px; padding:6px 10px; border-radius:999px;
      background:rgba(12,223,185,.12);
      border:1px solid rgba(12,223,185,.35); color:#b8fff1;
    }
    .row{display:flex; gap:10px; flex-wrap:wrap}
    .btn{
      appearance:none; border:0; cursor:pointer; border-radius:12px;
      padding:12px 16px; font-weight:700;
      background:linear-gradient(135deg,var(--roxo),#a64ccf);
      color:white; box-shadow:0 8px 22px rgba(98,23,112,.35);
      transition:transform .08s ease, filter .2s ease;
    }
    .btn:hover{transform:translateY(-1px)}
    .btn:active{transform:translateY(0)}
    .btn.outline{background:transparent; color:#e9d9f2; border:1px solid rgba(255,255,255,.16)}
    .btn.ghost{background:transparent; color:#d5f8f0; border:1px dashed rgba(12,223,185,.35)}
    .note{font-size:13px; color:var(--muted)}
    .list{margin:0; padding:0; list-style:none}
    .tx{display:flex; align-items:center; justify-content:space-between; gap:8px;
      padding:10px 0; border-bottom:1px dashed rgba(255,255,255,.08)}
    .tx:last-child{border-bottom:0}
    .tx .amt{font-weight:700}
    .ok{color:var(--ok)} .warn{color:var(--warn)}
    footer{margin-top:24px; text-align:center; color:var(--muted); font-size:12px}
    .chip{display:inline-flex; align-items:center; gap:8px; font-size:12px;
      padding:6px 10px; border-radius:999px;
      background:rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.1); color:#e6dff0;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo">ðŸ”®</div>
        <div class="title">
          <h1>Painel do Cliente</h1>
          <small>Cartomantes Online</small>
        </div>
      </div>
      <div class="chip" id="statusChip">Status: <strong>Conectado</strong></div>
    </header>

    <div class="grid">
      <!-- SALDO -->
      <section class="card">
        <div class="saldo">
          <div>
            <h2>Seu saldo disponÃ­vel</h2>
            <div class="valor" id="saldoView">R$ 0,00</div>
          </div>
          <span class="badge" id="lastCreditBadge" title="Ãšltimo crÃ©dito">sem crÃ©ditos</span>
        </div>

        <div class="row" style="margin-top:16px">
          <!-- BotÃ£o de pagamento fixo -->
          <a class="btn" target="_blank"
             href="https://cartomantespagamento.com.br/index.php?valor=10,00&descricao=MINUTOS%20ODARA">
            Adicionar R$ 10,00 (PIX)
          </a>
          <button class="btn outline" id="btnDetectar">Detectar pagamento</button>
          <button class="btn ghost" id="btnLimpar">Zerar saldo</button>
        </div>

        <p class="note" style="margin-top:10px">
          ApÃ³s o pagamento via PIX, vocÃª serÃ¡ redirecionado automaticamente de volta a esta pÃ¡gina com o saldo atualizado.
        </p>
      </section>

      <!-- HISTÃ“RICO -->
      <aside class="card">
        <h3 style="margin-top:0">MovimentaÃ§Ãµes</h3>
        <ul class="list" id="listaTx"></ul>
      </aside>
    </div>

    <footer>
      Â© <span id="year"></span> Cartomantes Online â€” Seu atendimento mÃ­stico
    </footer>
  </div>

  <script>
    // ===== Utilidades =====
    const fmt = new Intl.NumberFormat('pt-BR',{style:'currency', currency:'BRL'});
    const toNumberBR = v => Number(String(v||'').replace(/\./g,'').replace(',','.')) || 0;

    const STORAGE_SALDO = 'co_saldo_reais';
    const STORAGE_TX = 'co_tx_list';

    const getSaldo = () => Number(localStorage.getItem(STORAGE_SALDO)||'0');
    const setSaldo = n => localStorage.setItem(STORAGE_SALDO, String(n));
    const getTxList = () => JSON.parse(localStorage.getItem(STORAGE_TX)||'[]');
    const setTxList = arr => localStorage.setItem(STORAGE_TX, JSON.stringify(arr));

    const saldoView = document.getElementById('saldoView');
    const lastCreditBadge = document.getElementById('lastCreditBadge');
    const listaTx = document.getElementById('listaTx');
    document.getElementById('year').textContent = new Date().getFullYear();

    function renderSaldo(){ saldoView.textContent = fmt.format(getSaldo()); }
    function renderTx(){
      const tx = getTxList();
      listaTx.innerHTML = '';
      if (!tx.length){
        listaTx.innerHTML = '<li class="tx"><span>Nenhuma movimentaÃ§Ã£o</span><span class="amt">â€”</span></li>';
        lastCreditBadge.textContent = 'sem crÃ©ditos';
        return;
      }
      tx.slice().reverse().forEach(t => {
        const li = document.createElement('li');
        li.className = 'tx';
        const when = new Date(t.ts).toLocaleString('pt-BR', { timeZone: 'America/Fortaleza' });
        li.innerHTML = `<div><strong>${t.desc}</strong><br><small class="${t.tipo==='credito'?'ok':'warn'}">${when}</small></div><div class="amt">${t.tipo==='credito'?'+':'-'} ${fmt.format(t.valor)}</div>`;
        listaTx.appendChild(li);
      });
      const ult = tx[tx.length-1];
      if (ult && ult.tipo==='credito') lastCreditBadge.textContent = `Ãšltimo crÃ©dito: ${fmt.format(ult.valor)}`;
    }

    function addCredito(valor, desc='CrÃ©dito PIX'){
      const novo = getSaldo()+valor;
      setSaldo(novo);
      const tx = getTxList();
      tx.push({ tipo:'credito', valor, desc, ts:Date.now() });
      setTxList(tx);
      renderSaldo(); renderTx();
      toast(`CrÃ©dito recebido: ${fmt.format(valor)}`);
    }

    function creditFromURL(){
      const url = new URL(location.href);
      const status = (url.searchParams.get('status')||'').toLowerCase();
      const valorStr = url.searchParams.get('valor');
      const desc = url.searchParams.get('descricao')||'CrÃ©dito PIX';
      const valor = toNumberBR(valorStr);
      const okStatus = ['paid','approved','aprovado','ok','1','success','true'];

      if (!valor || !okStatus.includes(status)) return false;
      const onceKey = 'once_'+btoa(url.search);
      if (sessionStorage.getItem(onceKey)) return false;
      sessionStorage.setItem(onceKey,'1');
      addCredito(valor, desc);

      // Limpa URL
      url.searchParams.delete('status');
      url.searchParams.delete('valor');
      url.searchParams.delete('descricao');
      history.replaceState({}, '', url.pathname);
      return true;
    }

    document.getElementById('btnDetectar').onclick = ()=>{ toast(creditFromURL()?'Pagamento detectado!':'Nada para detectar.'); };
    document.getElementById('btnLimpar').onclick = ()=>{ if(confirm('Zerar saldo e histÃ³rico?')){ setSaldo(0); setTxList([]); renderSaldo(); renderTx(); toast('Saldo zerado.'); } };

    function toast(msg){
      const t=document.createElement('div');
      t.textContent=msg;
      Object.assign(t.style,{position:'fixed',left:'50%',bottom:'24px',transform:'translateX(-50%)',background:'rgba(0,0,0,.7)',color:'#fff',padding:'10px 14px',borderRadius:'10px',fontSize:'14px',boxShadow:'0 10px 20px rgba(0,0,0,.35)',zIndex:9999});
      document.body.appendChild(t);
      setTimeout(()=>t.remove(),2500);
    }

    renderSaldo(); renderTx();
    creditFromURL(); // detecta automaticamente ao abrir
  </script>
</body>
</html>
